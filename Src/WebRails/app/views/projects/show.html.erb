<% content_for(:title) { @project.name } %>

<div class="min-h-screen text-[#d4d4d8] p-6 lg:p-8 font-sans" style="background-color: #1a1a1a;">

  <div class="flex items-center justify-between mb-8 text-[13px]">
    <nav class="flex items-center gap-2 text-[#8b8b90]">
      <a href="/" class="hover:text-white transition-colors">Projects</a>
      <svg class="w-3.5 h-3.5 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
      <span class="text-[#d4d4d8]"><%= @project.name %></span>
    </nav>
    <div class="flex items-center gap-2">
      <%= button_to open_terminal_project_path(@project), method: :post, class: "px-3 h-8 rounded-md bg-[#161616] border border-[#3a3a3a] flex items-center gap-2 hover:bg-[#262626] transition-colors" do %>
        <svg class="w-4 h-4 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.75 7.5l3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0021 18V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v12a2.25 2.25 0 002.25 2.25z" /></svg>
        <span class="opacity-90">Open Terminal</span>
      <% end %>
      <%= button_to open_editor_project_path(@project), method: :post, class: "px-4 h-8 rounded-md bg-[#0088ff] hover:bg-[#0077ee] text-white flex items-center gap-1.5 transition-colors shadow-[0_0_10px_rgba(0,136,255,0.3)] font-medium" do %>
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" /></svg>
        <span><%= @editor_name %></span>
      <% end %>
    </div>
  </div>

  <div class="mb-6 border-b border-[#2a2a2a] pb-6">
    <div class="flex items-center gap-3 mb-2">
      <% if @project.is_pinned %>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pin"><path d="M12 17v5"></path><path d="M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z"></path></svg>
      <% end %>
      <h1 class="text-2xl font-medium tracking-wide text-white"><%= @project.name %></h1>
      <span class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] uppercase font-bold tracking-wide <%= status_classes(@project.status) %>">
        <span class="w-1.5 h-1.5 rounded-full mr-1.5" style="background-color: currentColor;"></span>
        <%= @project.status %>
      </span>
    </div>
    <div class="flex items-center gap-3 text-sm text-[#8b8b90] font-mono">
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 00-1.883 2.542l.857 6a2.25 2.25 0 002.227 1.932H19.05a2.25 2.25 0 002.227-1.932l.857-6a2.25 2.25 0 00-1.883-2.542m-16.5 0V6A2.25 2.25 0 016 3.75h3.879a1.5 1.5 0 011.06.44l2.122 2.12a1.5 1.5 0 001.06.44H18A2.25 2.25 0 0120.25 9v.776" /></svg>
      <span><%= @project.path %></span>
      <button onclick="copyToClipboard('<%= j @project.path %>')" class="hover:text-white transition-colors opacity-70 hover:opacity-100" title="Copy to clipboard">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75" /></svg>
      </button>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-12 gap-5 mb-12">

    <div class="lg:col-span-3 space-y-5">

      <div class="bg-[#161616] border border-[#2a2a2a] rounded-xl p-5 hover:bg-[#262626] transition-colors">
        <div class="flex items-center gap-2 mb-5 tracking-wide text-[11px] font-medium text-[#8b8b90] uppercase">
          <svg class="w-3.5 h-3.5 text-[#5b5b60]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 002.25-2.25V6.75a2.25 2.25 0 00-2.25-2.25H6.75A2.25 2.25 0 004.5 6.75v10.5a2.25 2.25 0 002.25 2.25z" /></svg>
          Inferred Tech Stack
        </div>
        <div class="space-y-1">
          <% @project.tech_pills.each_with_index do |pill, i| %>
            <div class="flex items-center gap-3 px-2 py-2 rounded-lg hover:bg-white/5 transition-colors cursor-default">
              <% if svg = tech_icon_svg(pill) %>
                <div class="w-7 h-7 flex items-center justify-center flex-shrink-0 [&>svg]:w-5 [&>svg]:h-5">
                  <%= svg %>
                </div>
              <% else %>
                <% colors = ["#e53935","#e65100","#2e7d32","#1565c0","#6a1b9a","#00838f","#c62828","#4527a0"] %>
                <% bg = colors[i % colors.length] %>
                <div class="w-7 h-7 rounded-lg flex items-center justify-center text-[10px] font-bold text-white flex-shrink-0" style="background-color: <%= bg %>;">
                  <%= pill.to_s[0..1].capitalize %>
                </div>
              <% end %>
              <span class="text-[13px] font-medium text-[#d4d4d8]"><%= pill %></span>
            </div>
          <% end %>
          <% if @project.tech_pills.empty? %>
            <span class="text-[11px] text-[#5b5b60] italic px-2">No inferred stack</span>
          <% end %>
        </div>
      </div>

      <div class="bg-[#161616] border border-[#2a2a2a] rounded-xl p-5 hover:bg-[#262626] transition-colors">
        <div class="flex items-center gap-2 mb-4 tracking-wide text-[11px] font-medium text-[#8b8b90] uppercase">
          <svg class="w-3.5 h-3.5 text-[#5b5b60]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" /><path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" /></svg>
          Dependencies
        </div>
        <div class="flex flex-wrap gap-2">
          <% @project.tag_list.first(6).each do |tag| %>
            <span class="inline-flex items-center px-2 py-1 text-[11px] font-medium text-[#d4d4d8] bg-[#1e1e20] border border-[#2a2a2a] rounded hover:bg-[#262626] transition-colors cursor-default"><%= tag %></span>
          <% end %>
          <% if @project.tag_list.size > 6 %>
            <span class="text-[11px] text-[#0088ff] font-medium cursor-default">+ <%= @project.tag_list.size - 6 %> more</span>
          <% end %>
          <% if @project.tag_list.empty? %>
            <span class="text-[11px] text-[#5b5b60] italic">No dependencies</span>
          <% end %>
        </div>
      </div>
    </div>

    <div class="lg:col-span-5">
      <div class="bg-[#161616] border border-[#2a2a2a] rounded-xl p-5 hover:bg-[#262626] transition-colors h-full">
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center gap-2 tracking-wide text-[11px] font-medium text-[#8b8b90] uppercase">
            <svg class="w-3.5 h-3.5 text-[#5b5b60]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" /></svg>
            Recent Activity
          </div>
          <a href="#" class="text-[11px] text-[#0088ff] hover:text-[#3399ff] transition-colors font-medium">View all history</a>
        </div>

        <div class="space-y-1">
          <% @project.recent_commits.first(5).each_with_index do |commit, i| %>
            <div class="flex items-start gap-3 px-2 py-3 rounded-lg hover:bg-white/5 transition-colors group border-b border-[#2a2a2a]/40 last:border-0">
              <div class="mt-1 flex-shrink-0">
                <% if i == 0 %>
                  <div class="w-2.5 h-2.5 rounded-full bg-[#0088ff] shadow-[0_0_8px_rgba(0,136,255,0.5)]"></div>
                <% else %>
                  <div class="w-2.5 h-2.5 rounded-full bg-[#3a3a3a]"></div>
                <% end %>
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-[13px] font-medium text-[#d4d4d8] mb-1.5 leading-snug group-hover:text-white transition-colors truncate"><%= commit[:message] %></p>
                <div class="flex items-center gap-2 text-[11px] text-[#5b5b60]">
                  <span class="flex items-center justify-center w-4 h-4 rounded-full bg-[#0088ff] text-[8px] font-bold text-white flex-shrink-0">
                    <%= commit[:author].present? ? commit[:author][0].upcase : "?" %>
                  </span>
                  <span class="text-[#8b8b90]"><%= commit[:author] %></span>
                  <span class="w-1 h-1 rounded-full bg-[#3a3a3a] flex-shrink-0"></span>
                  <span><%= format_commit_date(commit[:date]) %></span>
                  <% if commit[:sha] %>
                    <span class="ml-auto font-mono text-[10px] bg-[#1e1e20] border border-[#2a2a2a] px-1.5 py-0.5 rounded text-[#5b5b60]"><%= commit[:sha].to_s[0..6] %></span>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
          <% if @project.recent_commits.empty? %>
            <p class="text-[12px] text-[#5b5b60] italic px-2 py-4">No recent activity detected.</p>
          <% end %>
        </div>
      </div>
    </div>

    <div class="lg:col-span-4 space-y-5">

      <div class="bg-[#161616] border border-[#2a2a2a] rounded-xl p-5 hover:bg-[#262626] transition-colors">
        <div class="flex items-center gap-2 mb-5 tracking-wide text-[11px] font-medium text-[#8b8b90] uppercase">
          <svg class="w-3.5 h-3.5 text-[#5b5b60]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" /></svg>
          Project Health
        </div>

        <% risk = @project.stall_risk %>
        <div class="mb-5 pb-5 border-b border-[#2a2a2a]/50">
          <div class="flex justify-between items-end mb-2">
            <span class="text-[11px] text-[#8b8b90] font-medium">Stall Risk</span>
            <span class="text-[11px] font-bold" style="color: <%= risk[:color] %>;"><%= risk[:label] %></span>
          </div>
          <div class="w-full h-1.5 bg-[#2a2a2a] rounded-full overflow-hidden">
            <div class="h-full rounded-full" style="width: <%= risk[:width] %>; background-color: <%= risk[:color] %>; box-shadow: 0 0 8px <%= risk[:color] %>80;"></div>
          </div>
          <p class="text-[10px] text-[#5b5b60] mt-1.5">Last commit <%= @project.time_ago %></p>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-5">
          <div class="bg-[#1a1a1a] border border-[#2a2a2a] rounded-xl p-4">
            <span class="text-[11px] text-[#8b8b90] font-medium block mb-1">Total Files</span>
            <span class="text-2xl font-medium text-white"><%= @project.doc_count %></span>
          </div>
          <div class="bg-[#1a1a1a] border border-[#2a2a2a] rounded-xl p-4">
            <span class="text-[11px] text-[#8b8b90] font-medium block mb-1">Commits</span>
            <span class="text-2xl font-medium text-white"><%= @project.total_commits %></span>
          </div>
        </div>

        <div class="space-y-3.5 text-[12px]">
          <div class="flex items-start justify-between">
            <span class="text-[#8b8b90] font-medium">Last Scanned</span>
            <span class="font-medium text-[#d4d4d8] text-right"><%= @project.scanned_at&.strftime("%b %d, %H:%M") || "Never" %></span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-[#8b8b90] font-medium">Branch</span>
            <span class="flex items-center gap-1.5 font-medium text-[#d4d4d8]">
              <svg class="w-3.5 h-3.5 text-[#5b5b60]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 15h2.25m8.024-9.75c.011.05.028.1.052.148.591 1.2.924 2.55.924 3.977a8.96 8.96 0 01-.999 4.125m.023-8.25c-.076-.365.183-.75.575-.75h.908c.889 0 1.713.518 1.972 1.368.339 1.11.521 2.287.521 3.507 0 1.553-.295 3.036-.831 4.398C20.613 14.547 19.833 15 19 15h-1.053c-.472 0-.745-.556-.5-.96a8.95 8.95 0 00.303-.54m.023-8.25H16.48a4.5 4.5 0 01-1.423-.23l-3.114-1.04a4.5 4.5 0 00-1.423-.23H6.504c-.351 0-.674.244-.738.59-.064.346.12.684.453.842M5.25 15h13.5" /></svg>
              <%= @project.current_branch || "main" %>
            </span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-[#8b8b90] font-medium">Contributors</span>
            <div class="flex items-center -space-x-1.5">
              <% @project.contributor_names.first(3).each do |name| %>
                <div class="w-5 h-5 rounded-full bg-[#0088ff] border border-[#161616] flex items-center justify-center text-[8px] font-bold text-white" title="<%= name %>"><%= name.present? ? name[0].upcase : "?" %></div>
              <% end %>
              <% if @project.contributor_names.size > 3 %>
                <div class="w-5 h-5 rounded-full bg-[#2a2a2a] border border-[#161616] flex items-center justify-center text-[8px] font-bold text-[#8b8b90]">+<%= @project.contributor_names.size - 3 %></div>
              <% end %>
              <% if @project.contributor_names.empty? %>
                <span class="text-[11px] text-[#5b5b60] italic">None</span>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-[#161616] border border-[#2a2a2a] rounded-xl p-5 hover:bg-[#262626] transition-colors">
        <h3 class="text-[11px] font-medium tracking-wide text-[#8b8b90] uppercase mb-4">Quick Actions</h3>
        <div class="space-y-1">
          <%= button_to rescan_project_path(@project), method: :post, class: "w-full flex items-center gap-3 px-3 py-2.5 text-[13px] font-medium text-[#0088ff] rounded-lg hover:bg-white/5 transition-colors" do %>
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" /></svg>
            <span>Rescan Project</span>
          <% end %>

          <%= button_to toggle_pin_project_path(@project), method: :post, class: "w-full flex items-center gap-3 px-3 py-2.5 text-[13px] font-medium text-[#0088ff] rounded-lg hover:bg-white/5 transition-colors" do %>
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" /></svg>
            <span><%= @project.is_pinned ? "Unpin Project" : "Pin Project" %></span>
          <% end %>

          <%= link_to settings_path, class: "w-full flex items-center gap-3 px-3 py-2.5 text-[13px] font-medium text-[#0088ff] rounded-lg hover:bg-white/5 transition-colors" do %>
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 010 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 010-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
            <span>Project Settings</span>
          <% end %>

          <%= button_to project_path(@project), method: :delete, data: { turbo_confirm: "Are you sure you want to permanently delete #{@project.name}? This will remove the tracking and completely delete the files from your hard drive (#{@project.path}). This action cannot be undone." }, class: "w-full flex items-center gap-3 px-3 py-2.5 text-[13px] font-medium text-[#ff3b30] rounded-lg hover:bg-[#ff3b30]/10 transition-colors" do %>
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
            <span>Delete Project</span>
          <% end %>
        </div>
      </div>

    </div>
  </div>
</div>
