<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:ProjectDashboard.Avalonia.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="800"
             x:Class="ProjectDashboard.Avalonia.Views.ProjectDetailView"
             x:DataType="vm:ProjectDetailViewModel">



  <Panel Background="#1a1a1a">
    
    <StackPanel Spacing="24" Margin="24,24,24,32" IsEnabled="{Binding !ShowDeleteModal}">
        
        
        <Grid ColumnDefinitions="*,Auto">
          <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
            <Button Background="Transparent" Padding="0" x:Name="BackBtn" VerticalAlignment="Center" Cursor="Hand">
              <TextBlock Text="Projects" Foreground="#8b8b90" FontSize="13" VerticalAlignment="Center"/>
            </Button>
            <Path Width="12" Height="12" Stroke="#8b8b90" StrokeThickness="2" Data="M8.25 4.5l7.5 7.5-7.5 7.5" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding Project.Name}" Foreground="#d4d4d8" FontSize="13" VerticalAlignment="Center"/>
          </StackPanel>
          <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
            <Button Classes="actionBtn" x:Name="TerminalBtn">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <Path Width="12" Height="12" Stroke="#a1a1aa" StrokeThickness="1" Data="M6.75 7.5l3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0021 18V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v12a2.25 2.25 0 002.25 2.25z"/>
                <TextBlock Text="Terminal" Foreground="#d4d4d8" FontSize="13"/>
              </StackPanel>
            </Button>
            <Button Classes="primaryBtn" x:Name="OpenEditorBtn">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <Path Width="12" Height="12" Stroke="White" StrokeThickness="1" Data="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5"/>
                <TextBlock Text="{Binding EditorName}"/>
              </StackPanel>
            </Button>
          </StackPanel>
        </Grid>

        
        <Border BorderBrush="#2a2a2a" BorderThickness="0,0,0,1" Padding="0,0,0,24">
          <StackPanel Spacing="8">
            <StackPanel Orientation="Horizontal" Spacing="12">
              <TextBlock Text="{Binding Project.Name}" FontSize="24" FontWeight="Medium" Foreground="White"/>
              <Border Background="{Binding Project.Status, Converter={StaticResource StatusBgConverter}}" CornerRadius="4" Padding="6,2">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <Ellipse Width="6" Height="6" Fill="{Binding Project.Status, Converter={StaticResource StatusColorConverter}}"/>
                  <TextBlock Text="{Binding Project.Status}" Foreground="{Binding Project.Status, Converter={StaticResource StatusColorConverter}}" FontSize="10" FontWeight="Bold"/>
                </StackPanel>
              </Border>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="12">
              <Path Width="12" Height="12" Stroke="#8b8b90" StrokeThickness="1" Data="M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 00-1.883 2.542l.857 6a2.25 2.25 0 002.227 1.932H19.05a2.25 2.25 0 002.227-1.932l.857-6a2.25 2.25 0 00-1.883-2.542m-16.5 0V6A2.25 2.25 0 016 3.75h3.879a1.5 1.5 0 011.06.44l2.122 2.12a1.5 1.5 0 001.06.44H18A2.25 2.25 0 0120.25 9v.776"/>
              <TextBlock Text="{Binding Project.Path}" Foreground="#8b8b90" FontSize="13" FontFamily="Consolas"/>
              <Button Background="Transparent" Padding="4" x:Name="CopyPathBtn">
                <Path Width="12" Height="12" Stroke="#8b8b90" StrokeThickness="1" Data="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"/>
              </Button>
            </StackPanel>
          </StackPanel>
        </Border>

        
        <Grid ColumnDefinitions="1.5*,2.5*,2*" ColumnSpacing="20">
          
          
          <StackPanel Grid.Column="0" Spacing="20">
            
            <Border Classes="card" Padding="20">
              <StackPanel Spacing="16">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Path Width="14" Height="14" Stroke="#00E5FF" StrokeThickness="2" Data="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 002.25-2.25V6.75a2.25 2.25 0 00-2.25-2.25H6.75A2.25 2.25 0 004.5 6.75v10.5a2.25 2.25 0 002.25 2.25z"/>
                  <TextBlock Classes="labelTiny" Text="INFERRED TECH STACK"/>
                </StackPanel>
                <ItemsControl ItemsSource="{Binding Project.TechPills}">
                  <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                    <WrapPanel/>
                    </ItemsPanelTemplate>
                  </ItemsControl.ItemsPanel>
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Border Classes="pill" Margin="0,0,8,8">
                        <TextBlock Text="{Binding}" Foreground="#d4d4d8" FontSize="11" FontWeight="Medium"/>
                      </Border>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </StackPanel>
            </Border>

            
            <Border Classes="card" Padding="20">
              <StackPanel Spacing="16">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Path Width="14" Height="14" Stroke="#00E5FF" StrokeThickness="2" Data="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z M6 6h.008v.008H6V6z"/>
                  <TextBlock Classes="labelTiny" Text="TAGS"/>
                </StackPanel>
                <ItemsControl ItemsSource="{Binding Project.TagList}">
                  <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                      <WrapPanel/>
                    </ItemsPanelTemplate>
                  </ItemsControl.ItemsPanel>
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Border Classes="pill" Margin="0,0,8,8">
                        <TextBlock Text="{Binding}" Foreground="#d4d4d8" FontSize="11" FontWeight="Medium"/>
                      </Border>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
                <Button Background="Transparent" Padding="0" HorizontalAlignment="Left">
                  <StackPanel Orientation="Horizontal" Spacing="4">
                    <TextBlock Text="Manage Tags" Foreground="#0088ff" FontSize="11" FontWeight="Medium"/>
                    <Path Width="12" Height="12" Stroke="#0088ff" StrokeThickness="2" Data="M9 5l7 7-7 7"/>
                  </StackPanel>
                </Button>
              </StackPanel>
            </Border>
          </StackPanel>

          
          <Border Grid.Column="1" Classes="card" Padding="20">
            <StackPanel Spacing="24">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <Path Width="14" Height="14" Stroke="#00E5FF" StrokeThickness="2" Data="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"/>
                <TextBlock Classes="labelTiny" Text="RECENT ACTIVITY"/>
              </StackPanel>

              <ItemsControl ItemsSource="{Binding RecentCommits}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                      </Grid.ColumnDefinitions>
                      
                      <Panel Grid.Column="0">
                        <Rectangle Width="1" Fill="#2a2a2a" HorizontalAlignment="Center"/>
                        <Ellipse Width="10" Height="10" Fill="#0088ff" Stroke="#1e1e20" StrokeThickness="2" VerticalAlignment="Top" Margin="0,6,0,0"/>
                      </Panel>
                      
                      <Border BorderBrush="#2a2a2a" BorderThickness="0,0,0,0.5" Padding="4,4,0,24" Grid.Column="1">
                        <StackPanel Spacing="10">
                          <TextBlock Text="{Binding Message}" Foreground="#d4d4d8" FontSize="13" FontWeight="Medium" TextWrapping="Wrap" LineHeight="18"/>
                          <StackPanel Orientation="Horizontal" Spacing="10">
                            <Border Width="18" Height="18" CornerRadius="9" Background="#2a2a2a">
                              <TextBlock Text="{Binding AuthorInitial}" FontSize="8" FontWeight="Bold" Foreground="#d4d4d8" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="{Binding Author}" Foreground="#8b8b90" FontSize="11" FontWeight="Medium"/>
                            <Ellipse Width="3" Height="3" Fill="#3a3a3a"/>
                            <TextBlock Text="{Binding TimeAgo}" Foreground="#8b8b90" FontSize="11" FontWeight="Medium"/>
                          </StackPanel>
                        </StackPanel>
                      </Border>
                    </Grid>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </Border>

          
          <StackPanel Grid.Column="2" Spacing="20">
            
            <Border Classes="card" Padding="20">
              <StackPanel Spacing="20">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Path Width="14" Height="14" Stroke="#00E5FF" StrokeThickness="2" Data="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"/>
                  <TextBlock Classes="labelTiny" Text="PROJECT HEALTH"/>
                </StackPanel>

                <StackPanel Spacing="8">
                  <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Grid.Column="0" Classes="labelTiny" Text="Stall Risk"/>
                    <TextBlock Grid.Column="1" Text="{Binding StallRisk}" FontSize="11" FontWeight="Bold" Foreground="{Binding StallRiskColor}"/>
                  </Grid>
                  <Grid Height="6">
                    <Border Background="#2a2a2a" CornerRadius="3"/>
                    <Border CornerRadius="3" Width="{Binding StallRiskWidth}" Background="{Binding StallRiskColor}" HorizontalAlignment="Left"/>
                  </Grid>
                  <TextBlock Text="{Binding Project.TimeAgo, StringFormat='Last commit {0}'}" Foreground="#5b5b60" FontSize="10"/>
                </StackPanel>

                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                  <Border Classes="statBox">
                    <StackPanel>
                      <TextBlock Classes="labelTiny" Text="Total Files"/>
                      <TextBlock Text="{Binding Project.DocCount}" FontSize="20" FontWeight="Medium" Foreground="White" Margin="0,4,0,0"/>
                    </StackPanel>
                  </Border>
                  <Border Grid.Column="1" Classes="statBox">
                    <StackPanel>
                      <TextBlock Classes="labelTiny" Text="Commits"/>
                      <TextBlock Text="{Binding Project.TotalCommits}" FontSize="20" FontWeight="Medium" Foreground="White" Margin="0,4,0,0"/>
                    </StackPanel>
                  </Border>
                </Grid>

                <StackPanel Spacing="12">
                  <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Grid.Column="0" Classes="labelTiny" Text="Last Scanned"/>
                    <TextBlock Grid.Column="1" Text="{Binding Project.ScannedAt}" Foreground="#d4d4d8" FontSize="12" FontWeight="Medium"/>
                  </Grid>
                  <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Grid.Column="0" Classes="labelTiny" Text="Branch"/>
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="6">
                      <Path Width="14" Height="14" Stroke="#5b5b60" StrokeThickness="2" Data="M7.5 15h2.25m8.024-9.75c.011.05.028.1.052.148.591 1.2.924 2.55.924 3.977a8.96 8.96 0 01-.999 4.125m.023-8.25c-.076-.365.183-.75.575-.75h.908c.889 0 1.713.518 1.972 1.368.339 1.11.521 2.287.521 3.507 0 1.553-.295 3.036-.831 4.398C20.613 14.547 19.833 15 19 15h-1.053c-.472 0-.745-.556-.5-.96a8.95 8.95 0 00.303-.54m.023-8.25H16.48a4.5 4.5 0 01-1.423-.23l-3.114-1.04a4.5 4.5 0 00-1.423-.23H6.504c-.351 0-.674.244-.738.59-.064.346.12.684.453.842M5.25 15h13.5"/>
                      <TextBlock Text="{Binding Project.CurrentBranch}" Foreground="#d4d4d8" FontSize="12" FontWeight="Medium"/>
                    </StackPanel>
                  </Grid>
                  <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Grid.Column="0" Classes="labelTiny" Text="Contributors"/>
                    <ItemsControl Grid.Column="1" ItemsSource="{Binding ContributorNames}">
                      <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                          <StackPanel Orientation="Horizontal" Spacing="-6"/>
                        </ItemsPanelTemplate>
                      </ItemsControl.ItemsPanel>
                      <ItemsControl.ItemTemplate>
                        <DataTemplate>
                          <Border Width="20" Height="20" CornerRadius="10" Background="#0088ff" BorderBrush="#1e1e20" BorderThickness="2">
                            <TextBlock Text="{Binding ., Converter={StaticResource StringInitialConverter}}" FontSize="8" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                          </Border>
                        </DataTemplate>
                      </ItemsControl.ItemTemplate>
                    </ItemsControl>
                  </Grid>
                </StackPanel>
              </StackPanel>
            </Border>

            
            <Border Classes="card" Padding="20">
              <StackPanel Spacing="12">
                <TextBlock Classes="labelTiny" Text="QUICK ACTIONS" Padding="4,0,0,0"/>
                <Button Classes="quickAction" x:Name="RescanBtn" IsEnabled="{Binding !IsRescanning}">
                  <StackPanel Orientation="Horizontal" Spacing="12">
                    <Path Width="16" Height="16" Stroke="#a1a1aa" StrokeThickness="2" Data="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"/>
                    <TextBlock Text="{Binding RescanText}" Foreground="#d4d4d8" FontSize="13" FontWeight="Medium"/>
                  </StackPanel>
                </Button>
                <Button Classes="quickAction" x:Name="PinBtn">
                  <StackPanel Orientation="Horizontal" Spacing="12">
                    <Path Width="16" Height="16" Stroke="#a1a1aa" StrokeThickness="2" Data="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"/>
                    <TextBlock Text="{Binding PinText}" Foreground="#d4d4d8" FontSize="13" FontWeight="Medium"/>
                  </StackPanel>
                </Button>
                <Button Classes="quickAction" x:Name="SettingsNavBtn">
                  <StackPanel Orientation="Horizontal" Spacing="12">
                    <Path Width="16" Height="16" Stroke="#a1a1aa" StrokeThickness="2" Data="M10.34 15.84c-.4.07-.82.16-1.25.16-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7c0 .43-.09.85-.16 1.25M19.4 12c.3.56.5 1.18.57 1.84M22 22l-2-2M15.58 15.58l-1.06 1.06m0-4.24-1.42 1.42M12 10.5h.01"/>
                    <TextBlock Text="App Settings" Foreground="#d4d4d8" FontSize="13" FontWeight="Medium"/>
                  </StackPanel>
                </Button>
                <Button Classes="dangerBtn" x:Name="DeleteBtn">
                  <StackPanel Orientation="Horizontal" Spacing="12">
                    <Path Width="16" Height="16" Stroke="#ff3b30" StrokeThickness="2" Data="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    <TextBlock Text="Delete Project" Foreground="#ff3b30" FontSize="13" FontWeight="Medium"/>
                  </StackPanel>
                </Button>
              </StackPanel>
            </Border>
          </StackPanel>
        </Grid>
    </StackPanel>

    
    <Panel IsVisible="{Binding ShowDeleteModal}" ZIndex="100">
      <Border Background="#00000099" CornerRadius="0"/>
      <Border Background="#1e1e20" CornerRadius="12" BorderBrush="#2a2a2a" BorderThickness="1" Width="450" HorizontalAlignment="Center" VerticalAlignment="Center" Padding="24">
        <StackPanel Spacing="16">
          <StackPanel Orientation="Horizontal" Spacing="12">
            <Path Width="24" Height="24" Stroke="#ff3b30" StrokeThickness="2" Data="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            <TextBlock Text="Delete Project" FontSize="18" FontWeight="Medium" Foreground="#ff3b30"/>
          </StackPanel>
          
          <TextBlock TextWrapping="Wrap" Foreground="#8b8b90" FontSize="13">
            <Run Text="Are you sure you want to permanently delete "/>
            <Run Text="{Binding Project.Name}" FontWeight="SemiBold" Foreground="White"/>
            <Run Text="? This will remove the tracking from Project Dashboard and "/>
            <Run Text="completely delete the files from your hard drive" FontWeight="SemiBold" Foreground="#ff3b30"/>
            <Run Text=". This action cannot be undone."/>
          </TextBlock>

          <TextBlock Text="{Binding DeleteError}" Foreground="#ff3b30" FontSize="12" TextWrapping="Wrap" IsVisible="{Binding DeleteError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

          <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="12" Margin="0,8,0,0">
            <Button Grid.Column="1" Classes="actionBtn" x:Name="CancelDeleteBtn">
              <TextBlock Text="Cancel" Foreground="#d4d4d8" FontSize="13" FontWeight="Medium"/>
            </Button>
            <Button Grid.Column="2" Classes="primaryBtn" Background="#ff3b30" x:Name="ConfirmDeleteBtn" IsEnabled="{Binding !IsDeleting}">
              <TextBlock Text="{Binding DeleteButtonText}"/>
            </Button>
          </Grid>
        </StackPanel>
      </Border>
    </Panel>
  </Panel>
</UserControl>
